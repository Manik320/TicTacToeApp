<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Game</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .game-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-info {
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 15px;
        }

        .cell {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            font-size: 2em;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell:hover:not(:disabled) {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .cell:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .cell.x {
            color: #e74c3c;
        }

        .cell.o {
            color: #3498db;
        }

        .controls {
            margin-top: 20px;
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .winner-message {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
        }

        .draw-message {
            background: rgba(241, 196, 15, 0.2);
            border-color: #f1c40f;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 0.5s ease-in-out;
        }
    </style>
</head>
<body>
<div class="game-container">
    <h1>üéÆ Tic-Tac-Toe</h1>

    <div class="game-info">
        <div id="current-player">Current Player: X</div>
        <div id="game-status"></div>
    </div>

    <div class="board" id="board">
        <!-- Game board will be generated by JavaScript -->
    </div>

    <div class="controls">
        <button onclick="newGame()">New Game</button>
        <button onclick="resetGame()" id="reset-btn" style="display: none;">Reset Game</button>
    </div>
</div>

<script>
    let currentGame = null;
    const API_BASE = '/api/game';

    // Initialize the game board
    function initializeBoard() {
        const board = document.getElementById('board');
        board.innerHTML = '';

        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                const cell = document.createElement('button');
                cell.className = 'cell';
                cell.dataset.row = i;
                cell.dataset.col = j;
                cell.onclick = () => makeMove(i, j);
                board.appendChild(cell);
            }
        }
    }

    // Create a new game
    async function newGame() {
        try {
            const response = await fetch(`${API_BASE}/new`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                currentGame = await response.json();
                initializeBoard();
                updateDisplay();
                document.getElementById('reset-btn').style.display = 'inline-block';
            } else {
                alert('Failed to create new game');
            }
        } catch (error) {
            console.error('Error creating new game:', error);
            alert('Error creating new game');
        }
    }

    // Make a move
    async function makeMove(row, col) {
        if (!currentGame || currentGame.gameOver) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/${currentGame.gameId}/move`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    row: row,
                    col: col
                })
            });

            if (response.ok) {
                currentGame = await response.json();
                updateDisplay();

                // Add pulse animation to the clicked cell
                const clickedCell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                clickedCell.classList.add('pulse');
                setTimeout(() => clickedCell.classList.remove('pulse'), 500);
            } else {
                alert('Failed to make move');
            }
        } catch (error) {
            console.error('Error making move:', error);
            alert('Error making move');
        }
    }

    // Reset the current game
    async function resetGame() {
        if (!currentGame) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/${currentGame.gameId}/reset`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                currentGame = await response.json();
                updateDisplay();
            } else {
                alert('Failed to reset game');
            }
        } catch (error) {
            console.error('Error resetting game:', error);
            alert('Error resetting game');
        }
    }

    // Update the display with current game state
    function updateDisplay() {
        if (!currentGame) {
            return;
        }

        // Update board
        const cells = document.querySelectorAll('.cell');
        cells.forEach((cell, index) => {
            const row = Math.floor(index / 3);
            const col = index % 3;
            const value = currentGame.board[row][col];

            cell.textContent = value;
            cell.disabled = value !== '' || currentGame.gameOver;

            // Add styling based on value
            cell.className = 'cell';
            if (value === 'X') {
                cell.classList.add('x');
            } else if (value === 'O') {
                cell.classList.add('o');
            }
        });

        // Update current player and game status
        const currentPlayerEl = document.getElementById('current-player');
        const gameStatusEl = document.getElementById('game-status');

        if (currentGame.gameOver) {
            if (currentGame.winner) {
                gameStatusEl.innerHTML = `<div class="winner-message">üéâ Player ${currentGame.winner} Wins! üéâ</div>`;
            } else {
                gameStatusEl.innerHTML = `<div class="winner-message draw-message">ü§ù It's a Draw! ü§ù</div>`;
            }
            currentPlayerEl.textContent = 'Game Over';
        } else {
            currentPlayerEl.textContent = `Current Player: ${currentGame.currentPlayer}`;
            gameStatusEl.innerHTML = '';
        }
    }

    // Start with a new game when page loads
    window.onload = function() {
        newGame();
    };
</script>
</body>
</html>